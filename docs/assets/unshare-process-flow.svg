<svg width="800" height="450" viewBox="0 0 800 450" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect x="0" y="0" width="800" height="450" fill="#ffffff" rx="8"/>
  
  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" font-family="monospace" font-size="16" font-weight="bold" fill="#2c3e50">
    User Namespace Creation Process (unshare)
  </text>
  
  <!-- Step 1: Pod Start -->
  <rect x="50" y="50" width="220" height="100" fill="none" stroke="#2c3e50" stroke-width="2"/>
  <text x="160" y="75" text-anchor="middle" font-family="monospace" font-size="12" font-weight="bold" fill="#2c3e50">
    Step 1: Pod Start
  </text>
  <text x="65" y="100" font-family="monospace" font-size="10" fill="#34495e">
    Kubernetes starts pod:
  </text>
  <text x="65" y="120" font-family="monospace" font-size="10" fill="#34495e">
    • runAsUser: 1000
  </text>
  <text x="65" y="135" font-family="monospace" font-size="10" fill="#34495e">
    • No special privileges
  </text>
  
  <!-- Arrow -->
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#3498db"/>
    </marker>
  </defs>
  <line x1="270" y1="100" x2="315" y2="100" stroke="#3498db" stroke-width="2" marker-end="url(#arrow)"/>
  
  <!-- Step 2: Unshare Call -->
  <rect x="315" y="50" width="220" height="100" fill="none" stroke="#34495e" stroke-width="1.5"/>
  <text x="425" y="75" text-anchor="middle" font-family="monospace" font-size="12" font-weight="bold" fill="#2c3e50">
    Step 2: unshare()
  </text>
  <text x="330" y="100" font-family="monospace" font-size="10" fill="#34495e">
    Create user namespace:
  </text>
  <text x="330" y="120" font-family="monospace" font-size="10" fill="#34495e">
    • CLONE_NEWUSER
  </text>
  <text x="330" y="135" font-family="monospace" font-size="10" fill="#34495e">
    • Map root → UID 1000
  </text>
  
  <line x1="535" y1="100" x2="580" y2="100" stroke="#3498db" stroke-width="2" marker-end="url(#arrow)"/>
  
  <!-- Step 3: Build Execution -->
  <rect x="580" y="50" width="195" height="100" fill="#ecf0f1" stroke="#3498db" stroke-width="1"/>
  <text x="677" y="75" text-anchor="middle" font-family="monospace" font-size="12" font-weight="bold" fill="#2c3e50">
    Step 3: Build
  </text>
  <text x="595" y="100" font-family="monospace" font-size="10" fill="#34495e">
    Process runs as:
  </text>
  <text x="595" y="120" font-family="monospace" font-size="10" fill="#34495e">
    • UID 0 (inside)
  </text>
  <text x="595" y="135" font-family="monospace" font-size="10" fill="#34495e">
    • UID 1000 (host)
  </text>
  
  <!-- Detailed process view -->
  <text x="400" y="180" text-anchor="middle" font-family="monospace" font-size="14" font-weight="bold" fill="#2c3e50">
    Detailed Process Flow
  </text>
  
  <!-- Timeline -->
  <line x1="80" y1="210" x2="720" y2="210" stroke="#7f8c8d" stroke-width="2"/>
  
  <!-- Timeline markers -->
  <circle cx="80" cy="210" r="6" fill="#3498db"/>
  <circle cx="300" cy="210" r="6" fill="#3498db"/>
  <circle cx="520" cy="210" r="6" fill="#3498db"/>
  <circle cx="720" cy="210" r="6" fill="#3498db"/>
  
  <!-- Timeline labels -->
  <text x="80" y="235" text-anchor="middle" font-family="monospace" font-size="10" font-weight="bold" fill="#2c3e50">T0</text>
  <text x="300" y="235" text-anchor="middle" font-family="monospace" font-size="10" font-weight="bold" fill="#2c3e50">T1</text>
  <text x="520" y="235" text-anchor="middle" font-family="monospace" font-size="10" font-weight="bold" fill="#2c3e50">T2</text>
  <text x="720" y="235" text-anchor="middle" font-family="monospace" font-size="10" font-weight="bold" fill="#2c3e50">T3</text>
  
  <!-- Stage details -->
  <!-- T0 details -->
  <rect x="20" y="250" width="130" height="160" fill="none" stroke="#34495e" stroke-width="1"/>
  <text x="85" y="270" text-anchor="middle" font-family="monospace" font-size="11" font-weight="bold" fill="#2c3e50">Initial State</text>
  <text x="30" y="290" font-family="monospace" font-size="9" fill="#34495e">Host view:</text>
  <text x="30" y="305" font-family="monospace" font-size="9" fill="#7f8c8d">PID 12345</text>
  <text x="30" y="318" font-family="monospace" font-size="9" fill="#7f8c8d">UID 1000</text>
  <text x="30" y="331" font-family="monospace" font-size="9" fill="#7f8c8d">GID 1000</text>
  <text x="30" y="350" font-family="monospace" font-size="9" fill="#34495e">Container view:</text>
  <text x="30" y="365" font-family="monospace" font-size="9" fill="#7f8c8d">UID 1000</text>
  <text x="30" y="378" font-family="monospace" font-size="9" fill="#7f8c8d">GID 1000</text>
  <text x="30" y="398" font-family="monospace" font-size="8" font-style="italic" fill="#95a5a6">No namespace yet</text>
  
  <!-- T1 details -->
  <rect x="230" y="250" width="150" height="160" fill="none" stroke="#34495e" stroke-width="1"/>
  <text x="305" y="270" text-anchor="middle" font-family="monospace" font-size="11" font-weight="bold" fill="#2c3e50">Namespace Created</text>
  <text x="240" y="290" font-family="monospace" font-size="9" fill="#34495e">newuidmap called:</text>
  <text x="240" y="305" font-family="monospace" font-size="9" fill="#7f8c8d">0 1000 1</text>
  <text x="240" y="318" font-family="monospace" font-size="9" fill="#7f8c8d">1 100000 65535</text>
  <text x="240" y="338" font-family="monospace" font-size="9" fill="#34495e">newgidmap called:</text>
  <text x="240" y="353" font-family="monospace" font-size="9" fill="#7f8c8d">0 1000 1</text>
  <text x="240" y="366" font-family="monospace" font-size="9" fill="#7f8c8d">1 100000 65535</text>
  <text x="240" y="385" font-family="monospace" font-size="8" font-style="italic" fill="#95a5a6">Mappings established</text>
  
  <!-- T2 details -->
  <rect x="440" y="250" width="170" height="160" fill="none" stroke="#34495e" stroke-width="1"/>
  <text x="525" y="270" text-anchor="middle" font-family="monospace" font-size="11" font-weight="bold" fill="#2c3e50">Build Starts</text>
  <text x="450" y="290" font-family="monospace" font-size="9" fill="#34495e">Host view:</text>
  <text x="450" y="305" font-family="monospace" font-size="9" fill="#7f8c8d">UID 1000</text>
  <text x="450" y="318" font-family="monospace" font-size="9" fill="#7f8c8d">(unprivileged)</text>
  <text x="450" y="338" font-family="monospace" font-size="9" fill="#34495e">Namespace view:</text>
  <text x="450" y="353" font-family="monospace" font-size="9" fill="#7f8c8d">UID 0 (root)</text>
  <text x="450" y="366" font-family="monospace" font-size="9" fill="#7f8c8d">Full privileges*</text>
  <text x="450" y="385" font-family="monospace" font-size="8" font-style="italic" fill="#95a5a6">*Within namespace</text>
  
  <!-- T3 details -->
  <rect x="640" y="250" width="150" height="160" fill="#ecf0f1" stroke="#3498db" stroke-width="1"/>
  <text x="715" y="270" text-anchor="middle" font-family="monospace" font-size="11" font-weight="bold" fill="#2c3e50">Isolated ✓</text>
  <text x="650" y="290" font-family="monospace" font-size="9" fill="#34495e">Security boundary:</text>
  <text x="650" y="308" font-family="monospace" font-size="9" fill="#7f8c8d">✓ Root inside NS</text>
  <text x="650" y="323" font-family="monospace" font-size="9" fill="#7f8c8d">✓ UID 1000 on host</text>
  <text x="650" y="338" font-family="monospace" font-size="9" fill="#7f8c8d">✓ No host access</text>
  <text x="650" y="353" font-family="monospace" font-size="9" fill="#7f8c8d">✓ No privilege esc</text>
  <text x="650" y="368" font-family="monospace" font-size="9" fill="#7f8c8d">✓ Process isolated</text>
  <text x="650" y="385" font-family="monospace" font-size="8" font-style="italic" fill="#95a5a6">Build executes safely</text>
</svg>